#!/bin/bash

# 배열 선언 및 초기화
files=(
  "kinsing_1" "omelette_2" "sysrv_13" "sysrv_21" "sysrv_2" "sysrv_38" "sysrv_46" "sysrv_54"
  "sysrv_62" "sysrv_70" "sysrv_79" "sysrv_87" "sysrv_95" "teamtnt_4" "xmrig_14" "xmrig_6"
  "kinsing_2" "omelette_3" "sysrv_14" "sysrv_22" "sysrv_30" "sysrv_39" "sysrv_47" "sysrv_55"
  "sysrv_63" "sysrv_71" "sysrv_7" "sysrv_88" "sysrv_96" "teamtnt_5" "xmrig_15" "xmrig_7"
  "kinsing_3" "sysrv_100" "sysrv_15" "sysrv_23" "sysrv_31" "sysrv_3" "sysrv_48" "sysrv_56"
  "sysrv_64" "sysrv_72" "sysrv_80" "sysrv_89" "sysrv_97" "watchdog_1" "xmrig_16" "xmrig_8"
  "mexalz_1" "sysrv_101" "sysrv_16" "sysrv_24" "sysrv_32" "sysrv_40" "sysrv_49" "sysrv_57"
  "sysrv_65" "sysrv_73" "sysrv_81" "sysrv_8" "sysrv_98" "watchdog_2" "xmrig_17" "xmrig_9"
  "mexalz_2" "sysrv_102" "sysrv_17" "sysrv_25" "sysrv_33" "sysrv_41" "sysrv_4" "sysrv_58"
  "sysrv_66" "sysrv_74" "sysrv_82" "sysrv_90" "sysrv_99" "watchdog_3" "xmrig_1"
  "mexalz_3" "sysrv_103" "sysrv_18" "sysrv_26" "sysrv_34" "sysrv_42" "sysrv_50" "sysrv_59"
  "sysrv_67" "sysrv_75" "sysrv_83" "sysrv_91" "sysrv_9" "xmrig_10" "xmrig_2"
  "mexalz_4" "sysrv_10" "sysrv_19" "sysrv_27" "sysrv_35" "sysrv_43" "sysrv_51" "sysrv_5"
  "sysrv_68" "sysrv_76" "sysrv_84" "sysrv_92" "teamtnt_1" "xmrig_11" "xmrig_3"
  "mexalz_5" "sysrv_11" "sysrv_1" "sysrv_28" "sysrv_36" "sysrv_44" "sysrv_52" "sysrv_60"
  "sysrv_69" "sysrv_77" "sysrv_85" "sysrv_93" "teamtnt_2" "xmrig_12" "xmrig_4"
  "omelette_1" "sysrv_12" "sysrv_20" "sysrv_29" "sysrv_37" "sysrv_45" "sysrv_53" "sysrv_61"
  "sysrv_6" "sysrv_78" "sysrv_86" "sysrv_94" "teamtnt_3" "xmrig_13" "xmrig_5"
)

starti=$1
endi=$2
target=$3

# 배열을 순회하면서 요소 출력
for file in "${files[@]}"; do
  echo "$file"
  target_dir=dataset/malware_${file}

  ./create_vms.sh $starti $endi

  sleep 50

  ./run_malware.sh $file $starti $endi

  ./run_monitor.sh $starti $endi

  sleep 30

  mkdir -p $target_dir

  ./pull_datasets.sh $starti $endi $target_dir

  ./clean_ssh_keys.sh $starti $endi

  ./remove_vms.sh $starti $endi

done

echo "Completed"

